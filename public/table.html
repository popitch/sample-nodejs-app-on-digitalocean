<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <script src="https://cdn.jsdelivr.net/npm/underscore@latest/underscore-umd-min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://knockoutjs.com/downloads/knockout-3.5.1.js"></script>
    
    <script src="./js/format.js"></script>
    <script src="./js/rate-symbols.js"></script>
    <script src="./js/rates.js"></script>
    
      <link rel="stylesheet" href="./css/exchange-pair.css" type="text/css" media="screen" />
</head>
<body style="text-align: center">
    <div class="rates" data-bind="with: exchangeRates">
        <aside class="from" data-bind="foreach: PAIRS_FROM">
            <label data-bind="css: { selected: symbol === $parent.filter.from() }">
                <input type="radio" data-bind="
                    value: symbol,
                    checked: $parent.filter.from,
                 " />
                 <!-- ko text: name --><!-- /ko -->
            </label>
        </aside>
        
        <aside class="to" data-bind="foreach: PAIRS_TO">
            <label data-bind="css: { selected: symbol === $parent.filter.to() }">
                 <!-- ko text: name --><!-- /ko -->
                <input type="radio" data-bind="
                    value: symbol,
                    checked: $parent.filter.to,
                 " />
            </label>
        </aside>
        <!-- 
        <form data-bind="with: filter">
            <select data-bind="
                options: CURRENCY_LIST,
                optionsText: 'name',
                optionsValue: 'symbol',
                value: from
            "></select>
            
            <span data-bind="click: () => { let cur = from(); from(to()); to(cur); }">
                &rarr;
            </span>
            
            <select data-bind="
                options: CURRENCY_LIST,
                optionsText: 'name',
                optionsValue: 'symbol',
                value: to
            "></select>
        </form>
         -->
        <table>
            <thead data-bind="with: filter">
                <tr data-bind="css: 'sort-dir_' + sortDir()">
                    <td class="rate-col rate-service" data-bind="style: { color: $parent.loading() ? 'black' : 'transparent' }">...</td>
                    <td class="rate-col rate-changer" data-bind="css: { 'sort-by': sortBy() === 'changer' }, click: () => toSort('changer')">Обменник</td>
                    <td class="rate-col rate-from"    data-bind="css: { 'sort-by': sortBy() === 'from' }, click: () => toSort('from')">Отдаёте</td>
                    <td class="rate-col rate-to"      data-bind="css: { 'sort-by': sortBy() === 'to' }, click: () => toSort('to')">Получаете</td>
                    <td class="rate-col rate-amount"  data-bind="css: { 'sort-by': sortBy() === 'amount' }, click: () => toSort('amount')">Резерв</td>
                </tr>
            </thead>
            <tbody data-bind="foreach: rates.sortedDirectedFixedFloating">
                <tr>
                    <td class="rate-col rate-service"></td>
                    <td class="rate-col rate-changer" data-bind="with: EXCHANGER_BY_ID()[ exchangerId ]">
                        <a href target="_blank" data-bind="
                            text: name,
                            attr: {
                                href: rateExchangeUrl($parent, $data)
                            }
                           "></a>
                    </td>
                    <td class="rate-col rate-from" data-bind="template: { name: 'number-currency.template', data: { value: $data['in'], symbol: $data['from'] } }"></td>
                    <td class="rate-col rate-to" data-bind="template: { name: 'number-currency.template', data: { value: $data['out'], symbol: $data['to'] } }"></td>
                    <td class="rate-col rate-amount" data-bind="text: $data['amount']"></td>
                </tr>
            </tbody>
            <tbody style="display: none" data-bind="visible: ! loading() && rates().length === 0">
                <tr>
                    <td colspan="8">Нет данных для выбранного направления обмена.</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <script type="html/template" id="number-currency.template">
        <strong data-bind="text: value"></strong>
        <small data-bind="text: CURRENCY_NAME_BY_SYMBOL[symbol] || symbol"></small>
    </script>
    
    <script src="./js/table.js"></script>
</body>
